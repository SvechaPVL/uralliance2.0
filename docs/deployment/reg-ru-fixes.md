# üîß –§–∏–∫—Å—ã –¥–ª—è REG.RU —Å–µ—Ä–≤–µ—Ä–æ–≤

## MTU Settings –¥–ª—è Docker

–ù–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö REG.RU –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MTU 1450 –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ 1500.

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ MTU (1500) –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç–µ–≤—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

### –†–µ—à–µ–Ω–∏–µ

#### 1. Docker Daemon Configuration

**–§–∞–π–ª:** `/etc/docker/daemon.json` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```json
{
  "mtu": 1450,
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

#### 2. Docker Compose Network

**–§–∞–π–ª:** `docker-compose.yml`

```yaml
networks:
  uralliance-network:
    driver: bridge
    driver_opts:
      com.docker.network.driver.mtu: 1450
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo systemctl restart docker

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker network inspect bridge | grep -i mtu
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: "com.docker.network.driver.mtu": "1450"
```

---

## Husky –∏ TypeScript –≤ Production Build

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Husky –≤ Docker Build

Husky (git hooks) –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è `npm ci` –≤ Docker build, –Ω–æ:

- Husky –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è development
- –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–µ—Ç git
- –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É build

### –ü—Ä–æ–±–ª–µ–º–∞ 2: TypeScript –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

Next.js –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å `next.config.ts` –ø–æ—Ç–æ–º—É —á—Ç–æ:

- TypeScript —è–≤–ª—è–µ—Ç—Å—è devDependency
- –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Ç–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π TypeScript –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- Next.js build —Ç—Ä–µ–±—É–µ—Ç TypeScript –¥–ª—è —Ç—Ä–∞–Ω—Å–ø–∏–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º multi-stage build —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

**Stage 1 (deps):** Production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

```dockerfile
RUN npm ci --only=production --ignore-scripts
```

**Stage 2 (builder):** –í–°–ï –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è dev) –¥–ª—è —Å–±–æ—Ä–∫–∏

```dockerfile
RUN npm ci --ignore-scripts
```

**Stage 3 (runner):** –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ stage 1

–§–ª–∞–≥ `--ignore-scripts` –≤ –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö:

- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç `prepare` —Å–∫—Ä–∏–ø—Ç (husky)
- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥—Ä—É–≥–∏–µ postinstall —Å–∫—Ä–∏–ø—Ç—ã
- –ù–µ –ª–æ–º–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ß—Ç–æ —ç—Ç–æ –Ω–µ –ª–æ–º–∞–µ—Ç

‚úÖ TypeScript –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–±–æ—Ä–∫–∏ –≤ builder stage
‚úÖ Next.js build —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
‚úÖ –í—Å–µ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ production –∫–æ–¥
‚úÖ Application —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–§–∞–π–ª:** `Dockerfile`, —Å—Ç—Ä–æ–∫–∏ 10 –∏ 18

---

## Docker Compose v2 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω)

### –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –ø–ª–∞–≥–∏–Ω (`docker compose`), –∞ –Ω–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (`docker-compose`).

–û—à–∏–±–∫–∞:

```
bash: line 14: docker-compose: command not found
```

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `docker compose` (—Å –ø—Ä–æ–±–µ–ª–æ–º) –≤–º–µ—Å—Ç–æ `docker-compose` (—Å –¥–µ—Ñ–∏—Å–æ–º):

```bash
# –°—Ç–∞—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
docker-compose up -d

# –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç)
docker compose up -d
```

### –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

- **GitHub Actions workflow:** `.github/workflows/deploy.yml`
- –í—Å–µ deployment —Å–∫—Ä–∏–ø—Ç—ã

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö REG.RU —Å–µ—Ä–≤–µ—Ä–æ–≤

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ REG.RU:

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker (–≤–µ—Ä—Å–∏—è 20.10+)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `/etc/docker/daemon.json` —Å MTU 1450
3. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker: `systemctl restart docker`
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MTU: `docker network inspect bridge | grep mtu`
5. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `docker compose` (–Ω–µ `docker-compose`)
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker Compose: `docker compose version`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 89.111.153.225

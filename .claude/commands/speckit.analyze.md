---
description: Выполнить неразрушающий кросс-артефактный анализ согласованности и качества в spec.md, plan.md и tasks.md после генерации задач.
---

## Пользовательский Ввод

```text
$ARGUMENTS
```

Вы **ДОЛЖНЫ** учитывать пользовательский ввод перед продолжением (если не пуст).

## Цель

Выявить несоответствия, дублирования, неоднозначности и недоопределенные элементы в трех основных артефактах (`spec.md`, `plan.md`, `tasks.md`) перед реализацией. Эта команда ДОЛЖНА запускаться только после того, как `/speckit.tasks` успешно создал полный `tasks.md`.

## Рабочие Ограничения

**СТРОГО ТОЛЬКО ЧТЕНИЕ**: **Не** изменяйте никакие файлы. Выводите структурированный отчет анализа. Предложите опциональный план исправлений (пользователь должен явно одобрить перед тем, как какие-либо последующие команды редактирования будут вызваны вручную).

**Авторитет Конституции**: Конституция проекта (`.specify/memory/constitution.md`) является **не подлежащей обсуждению** в рамках этого анализа. Конфликты с конституцией автоматически являются КРИТИЧЕСКИМИ и требуют корректировки спецификации, плана или задач — не размывания, переинтерпретации или тихого игнорирования принципа. Если сам принцип нуждается в изменении, это должно произойти в отдельном, явном обновлении конституции вне `/speckit.analyze`.

## Шаги Выполнения

### 1. Инициализация Контекста Анализа

Запустите `.specify/scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks` один раз из корня репозитория и разберите JSON для FEATURE_DIR и AVAILABLE_DOCS. Получите абсолютные пути:

- SPEC = FEATURE_DIR/spec.md
- PLAN = FEATURE_DIR/plan.md
- TASKS = FEATURE_DIR/tasks.md

Прервите с сообщением об ошибке, если какой-либо требуемый файл отсутствует (проинструктируйте пользователя запустить отсутствующую предварительную команду).
Для одинарных кавычек в аргументах вроде "I'm Groot", используйте синтаксис экранирования: напр. 'I'\''m Groot' (или двойные кавычки если возможно: "I'm Groot").

### 2. Загрузка Артефактов (Прогрессивное Раскрытие)

Загружайте только минимально необходимый контекст из каждого артефакта:

**Из spec.md:**

- Обзор/Контекст
- Функциональные Требования
- Нефункциональные Требования
- Пользовательские Истории
- Крайние Случаи (если присутствуют)

**Из plan.md:**

- Выбор архитектуры/стека
- Ссылки на модель данных
- Фазы
- Технические ограничения

**Из tasks.md:**

- ID задач
- Описания
- Группировка по фазам
- Маркеры параллелизма [P]
- Ссылаемые пути к файлам

**Из конституции:**

- Загрузите `.specify/memory/constitution.md` для проверки принципов

### 3. Построение Семантических Моделей

Создайте внутренние представления (не включайте исходные артефакты в вывод):

- **Инвентарь требований**: Каждое функциональное + нефункциональное требование со стабильным ключом (выведите слаг на основе императивной фразы; напр., "Пользователь может загрузить файл" → `user-can-upload-file`)
- **Инвентарь пользовательских историй/действий**: Дискретные действия пользователей с критериями приемки
- **Картирование покрытия задачами**: Сопоставьте каждую задачу с одним или более требованиями или историями (вывод по ключевым словам / явным шаблонам ссылок вроде ID или ключевых фраз)
- **Набор правил конституции**: Извлеките имена принципов и нормативные утверждения MUST/SHOULD

### 4. Проходы Обнаружения (Токен-Эффективный Анализ)

Фокус на высокосигнальных находках. Ограничение в 50 находок всего; остальные агрегируйте в сводку переполнения.

#### A. Обнаружение Дублирования

- Выявите почти дублирующиеся требования
- Отметьте менее качественную формулировку для консолидации

#### B. Обнаружение Неоднозначности

- Отметьте расплывчатые прилагательные (быстрый, масштабируемый, безопасный, интуитивный, надежный) без измеримых критериев
- Отметьте неразрешенные заполнители (TODO, TKTK, ???, `<placeholder>` и т.д.)

#### C. Недоопределенность

- Требования с глаголами, но без объекта или измеримого результата
- Пользовательские истории без выравнивания критериев приемки
- Задачи, ссылающиеся на файлы или компоненты, не определенные в spec/plan

#### D. Соответствие Конституции

- Любое требование или элемент плана, конфликтующий с принципом MUST
- Отсутствующие обязательные разделы или контрольные точки качества из конституции

#### E. Пробелы в Покрытии

- Требования без связанных задач
- Задачи без сопоставленного требования/истории
- Нефункциональные требования, не отраженные в задачах (напр., производительность, безопасность)

#### F. Несоответствие

- Терминологический дрейф (одна концепция названа по-разному в разных файлах)
- Сущности данных, упомянутые в плане, но отсутствующие в спецификации (или наоборот)
- Противоречия в упорядочении задач (напр., задачи интеграции перед фундаментальными задачами настройки без примечания о зависимости)
- Конфликтующие требования (напр., одно требует Next.js, другое указывает Vue)

### 5. Назначение Серьезности

Используйте эту эвристику для приоритизации находок:

- **КРИТИЧЕСКИЙ**: Нарушает MUST конституции, отсутствует основной артефакт спецификации, или требование с нулевым покрытием, блокирующее базовую функциональность
- **ВЫСОКИЙ**: Дублированное или конфликтующее требование, неоднозначный атрибут безопасности/производительности, нетестируемый критерий приемки
- **СРЕДНИЙ**: Терминологический дрейф, отсутствующее покрытие нефункциональных задач, недоопределенный крайний случай
- **НИЗКИЙ**: Стиль/улучшения формулировок, незначительная избыточность, не влияющая на порядок выполнения

### 6. Создание Компактного Отчета Анализа

Выведите Markdown отчет (без записи файлов) со следующей структурой:

## Отчет Анализа Спецификации

| ID  | Категория    | Серьезность | Местоположение(я) | Резюме                     | Рекомендация                                          |
| --- | ------------ | ----------- | ----------------- | -------------------------- | ----------------------------------------------------- |
| A1  | Дублирование | ВЫСОКИЙ     | spec.md:L120-134  | Два похожих требования ... | Объединить формулировку; оставить более четкую версию |

(Добавьте одну строку на находку; генерируйте стабильные ID с префиксом начальной буквы категории.)

**Таблица Сводки Покрытия:**

| Ключ Требования | Есть Задача? | ID Задач | Примечания |
| --------------- | ------------ | -------- | ---------- |

**Проблемы Соответствия Конституции:** (если есть)

**Несопоставленные Задачи:** (если есть)

**Метрики:**

- Всего Требований
- Всего Задач
- Покрытие % (требования с >=1 задачей)
- Количество Неоднозначностей
- Количество Дублирований
- Количество Критических Проблем

### 7. Предоставление Следующих Действий

В конце отчета выведите краткий блок Следующие Действия:

- Если существуют КРИТИЧЕСКИЕ проблемы: Рекомендуйте разрешить перед `/speckit.implement`
- Если только LOW/MEDIUM: Пользователь может продолжить, но предоставьте предложения по улучшению
- Предоставьте явные предложения команд: напр., "Запустите /speckit.specify с доработкой", "Запустите /speckit.plan для корректировки архитектуры", "Вручную отредактируйте tasks.md для добавления покрытия для 'performance-metrics'"

### 8. Предложение Исправления

Спросите пользователя: "Хотите ли вы, чтобы я предложил конкретные правки для исправления топ N проблем?" (НЕ применяйте их автоматически.)

## Принципы Работы

### Эффективность Контекста

- **Минимум высокосигнальных токенов**: Фокус на действенных находках, не исчерпывающей документации
- **Прогрессивное раскрытие**: Загружайте артефакты постепенно; не сбрасывайте весь контент в анализ
- **Токен-эффективный вывод**: Ограничьте таблицу находок 50 строками; остальное суммируйте
- **Детерминированные результаты**: Повторный запуск без изменений должен производить согласованные ID и счетчики

### Руководства по Анализу

- **НИКОГДА не изменяйте файлы** (это анализ только для чтения)
- **НИКОГДА не галлюцинируйте отсутствующие разделы** (если отсутствуют, сообщайте о них точно)
- **Приоритизируйте нарушения конституции** (они всегда КРИТИЧЕСКИЕ)
- **Используйте примеры вместо исчерпывающих правил** (цитируйте конкретные случаи, не общие шаблоны)
- **Сообщайте о нулевых проблемах корректно** (выводите отчет об успехе со статистикой покрытия)

## Контекст

$ARGUMENTS
